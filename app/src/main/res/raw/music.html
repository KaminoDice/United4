<!doctype html>
<html>
    <head>
        <script>
            var page = 0;
            var items_per_page = 3;
            var ol = function ol() {
                if (typeof(window.unitedPropertiesIf) == "undefined") {
                    window.unitedPropertiesIf = {
                        getSessionVariable: function(name) {
                            return "0";
                        },
                        getProperty: function(name) {
                            if (name == "playing_song") return null;
                            return JSON.stringify(["a", "b", "c"]);
                        },
                        setSessionVariable: function(name, value) {},
                        setProperty: function(name, value) {},
                        playSong: function(name) {
                            alert("Playing song " + name)
                        }
                    }
                }
                var img1 = document.getElementById("img1");
                var img2 = document.getElementById("img2");
                var i1h = img1.clientHeight;
                img2.style.top = i1h.toString() + "px";
                var i2h = img2.clientHeight;
                document.getElementById("prev").style.top = (i1h + i2h).toString() + "px";
                document.getElementById("next").style.top = (i1h + i2h).toString() + "px";
                document.getElementById("contents").style.top = (i1h + i2h).toString() + "px";
                page = unitedPropertiesIf.getSessionVariable("page");
                if (page == null || page == undefined || page.trim().length == 0) {
                    page = 0;
                }
                changeCurrentSong();
                newPage();
            }
            var changeCurrentSong = function changeCurrentSong() {
                var song = document.getElementById("song");
                var i1h = img1.clientHeight;
                img2.style.top = i1h.toString() + "px";
                var i2h = img2.clientHeight;
                var playing_song = unitedPropertiesIf.getProperty("playing_song");
                var text = playing_song;
                if (playing_song == null || playing_song == undefined || playing_song.trim().length == 0) {
                    text = "Nothing Playing";
                }
                song.innerText = text;
                song.style.top = (i1h + (i2h/2) - (song.clientHeight/2)).toString() + "px";
            }
            var newPage = function newPage() {
                var contents = document.getElementById("contents");
                contents.innerHTML = "";
                unitedPropertiesIf.setSessionVariable("page", page.toString());
                var all_songs = JSON.parse(unitedPropertiesIf.getProperty("ordered_songs"));
                var max_page = Math.ceil(all_songs.length / items_per_page) - 1;
                var start = page * items_per_page;
                if (page == 0) {
                    document.getElementById("prev").src = "prev_disabled.png";
                } else {
                    document.getElementById("prev").src = "prev_enabled.png";
                }
                console.log(max_page)
                if (page >= max_page) {
                    document.getElementById("next").src = "next_disabled.png";
                } else {
                    document.getElementById("next").src = "next_enabled.png";
                }
                for (var i = 0; i < items_per_page; i++) {
                    var index = start + i;
                    var song = all_songs[index];
                    if (song == undefined) breal;
                    var text = document.createElement("span");
                    (function(text, song) {
                        text.addEventListener("click", function() {
                            playSong(song);
                        });
                    })(text, song);
                    text.innerText = song;
                    if (song == unitedPropertiesIf.getProperty("playing_song")) {
                        text.style.border = "2px solid #ffbb31";
                    } else {
                        text.style.border = "2px solid #3C84CF"
                    }
                    text.classList.add("text");
                    text.style.lineHeight = "50px";
                    text.style.color = "white"
                    text.style.zIndex = "10"
                    text.style.position = "absolute"
                    text.style.display = "block"
                    text.style.textAlign = "center";
                    text.classList.add("wrapper");
                    contents.appendChild(text);
                    text.style.top = (20 + (i * 70)).toString() + "px";
                    var size = 15;
                    do {
                        text.style.fontSize = size.toString() + "px"
                        size--;
                    } while (text.clientHeight > 50)
                }
            }
            var playSong = function playSong(title) {
                unitedPropertiesIf.setProperty("playing_song", title);
                unitedPropertiesIf.playSong(title);
                document.getElementById("song").innerText = title;
                newPage();
            }
            window.prev = function prev() {
                if (page == 0) {
                    unitedPropertiesIf.playSound("NoPagesLeft.mp3");
                    return;
                }
                unitedPropertiesIf.playSound("NextPage.mp3");
                page--;
                newPage();
            }
            window.next = function next() {
                if (document.getElementById("next").src.indexOf("disabled") >= 0) {
                    unitedPropertiesIf.playSound("NoPagesLeft.mp3");
                    return;
                }
                unitedPropertiesIf.playSound("NextPage.mp3");
                page += 1;
                newPage();
            }
        </script>
        <style>
            body {
                text-align: center;
                background-color: black;
                font-family: monospace;
            }
            #img1 {
                position: absolute;
                top: 0;
                left: 0;
                width: 100%;
            }
            #img2, #song {
                position: absolute;
                left: 0;
                width: 100%;
                color: white;
            }
            #next {
                position: absolute;
                z-index: 10;
                left: 90%;
                width: 10%;
            }
            #prev {
                position: absolute;
                z-index: 10;
                left: 0;
                width: 10%;
            }
            #contents {
                width: 100%;
                position: absolute;
                left: 0;
            }
            .song {
                width: 90%;
            }
            .wrapper {
                position: absolute;
                width: auto;
                left: 12%;
                right: 12%;
            }
        </style>
    </head>
    <body onLoad='ol()'>
        <img id="img1" src="music_backdrop.png" />
        <img id="img2" src="music_text_backdrop.png" />
        <div id="song" style="z-index: 10;"></div>
        <img id="prev" onClick='window.prev()' />
        <img id="next" onClick='window.next()' />
        <div id="contents">
        </div>
    </body>
</html>
